<Window x:Class="PicView.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PicView"
        xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
        mc:Ignorable="d"
        Title="PicView - Advanced Image Viewer" Height="800" Width="1200"
        KeyDown="MainWindow_KeyDown"
        Drop="MainWindow_Drop"
        AllowDrop="True">
    
    <Window.Resources>
        <!-- 透明方格画笔 -->
        <DrawingBrush x:Key="CheckerboardBrush" TileMode="Tile" Viewport="0,0,20,20" ViewportUnits="Absolute">
            <DrawingBrush.Drawing>
                <DrawingGroup>
                    <GeometryDrawing Brush="White" Geometry="M 0,0 L 10,0 L 10,10 L 0,10 Z"/>
                    <GeometryDrawing Brush="LightGray" Geometry="M 10,0 L 20,0 L 20,10 L 10,10 Z"/>
                    <GeometryDrawing Brush="LightGray" Geometry="M 0,10 L 10,10 L 10,20 L 0,20 Z"/>
                    <GeometryDrawing Brush="White" Geometry="M 10,10 L 20,10 L 20,20 L 10,20 Z"/>
                </DrawingGroup>
            </DrawingBrush.Drawing>
        </DrawingBrush>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- 主工具栏 -->
        <ToolBar Grid.Row="0" Height="40">
            <Button x:Name="btnOpen" Content="打开" Click="BtnOpen_Click" Padding="10,5"/>
            <Separator/>
            <Button x:Name="btnPrevious" Content="◀" Click="BtnPrevious_Click" Padding="10,5" ToolTip="上一张 (Left)"/>
            <Button x:Name="btnNext" Content="▶" Click="BtnNext_Click" Padding="10,5" ToolTip="下一张 (Right)"/>
            <Separator/>
            <Button x:Name="btnRotateLeft" Content="↺" Click="BtnRotateLeft_Click" Padding="10,5" ToolTip="左旋转"/>
            <Button x:Name="btnRotateRight" Content="↻" Click="BtnRotateRight_Click" Padding="10,5" ToolTip="右旋转"/>
            <Separator/>
            <Button x:Name="btnSaveAs" Content="另存为" Click="BtnSaveAs_Click" Padding="10,5"/>
            <Separator/>
            <Button x:Name="btnSearch" Content="搜索" Click="BtnSearch_Click" Padding="10,5" ToolTip="Everything搜索"/>
            <CheckBox x:Name="chkShowChannels" Content="显示通道" Checked="ChkShowChannels_Checked" Unchecked="ChkShowChannels_Unchecked" Margin="10,0"/>
        </ToolBar>
        
        <!-- Everything 搜索栏 -->
        <Grid Grid.Row="1" x:Name="searchPanel" Visibility="Collapsed" Background="#F0F0F0" Height="40">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Text="搜索:" VerticalAlignment="Center" Margin="10,0"/>
            <TextBox x:Name="txtSearch" Grid.Column="1" Margin="5" VerticalAlignment="Center" KeyDown="TxtSearch_KeyDown"/>
            <Button x:Name="btnCloseSearch" Grid.Column="2" Content="✕" Click="BtnCloseSearch_Click" Margin="5" Width="30"/>
        </Grid>
        
        <!-- 背景控制工具栏 -->
        <Expander Grid.Row="2" Header="背景设置" IsExpanded="True">
            <StackPanel Orientation="Horizontal" Height="86" Background="#F8F8F8">
                <!-- 背景类型选择 -->
                <GroupBox Header="背景类型" Margin="5">
                    <StackPanel Orientation="Horizontal">
                        <RadioButton x:Name="rbTransparent" Content="透明方格" Checked="BackgroundType_Changed" Margin="5"/>
                        <RadioButton x:Name="rbSolidColor" Content="纯色" Checked="BackgroundType_Changed" Margin="5"/>
                        <RadioButton x:Name="rbImageBackground" Content="图片" Checked="BackgroundType_Changed" Margin="5"/>
                        <RadioButton x:Name="rbWindowTransparent" Content="窗口透明" Checked="BackgroundType_Changed" Margin="5"/>
                    </StackPanel>
                </GroupBox>
                
                <!-- 预设颜色 -->
                <GroupBox Header="预设颜色" Margin="5">
                    <StackPanel Orientation="Horizontal">
                        <Button x:Name="btnWhite" Width="30" Height="30" Background="White" Margin="2" Click="PresetColor_Click" Tag="White"/>
                        <Button x:Name="btnBlack" Width="30" Height="30" Background="Black" Margin="2" Click="PresetColor_Click" Tag="Black"/>
                        <Button x:Name="btnNeutralGray" Width="30" Height="30" Background="#808080" Margin="2" Click="PresetColor_Click" Tag="#808080"/>
                        <Button x:Name="btnLightGray" Width="30" Height="30" Background="#C0C0C0" Margin="2" Click="PresetColor_Click" Tag="#C0C0C0"/>
                        <Button x:Name="btnDarkGray" Width="30" Height="30" Background="#404040" Margin="2" Click="PresetColor_Click" Tag="#404040"/>
                    </StackPanel>
                </GroupBox>
                
                <!-- 颜色调节 -->
                <GroupBox Header="颜色调节" Margin="5">
                    <StackPanel Orientation="Horizontal">
                        <StackPanel Margin="5">
                            <TextBlock Text="色相" HorizontalAlignment="Center"/>
                            <Slider x:Name="sliderHue" Width="100" Minimum="0" Maximum="360" ValueChanged="ColorSlider_ValueChanged"/>
                        </StackPanel>
                        <StackPanel Margin="5">
                            <TextBlock Text="明度" HorizontalAlignment="Center"/>
                            <Slider x:Name="sliderBrightness" Width="100" Minimum="0" Maximum="100" Value="50" ValueChanged="ColorSlider_ValueChanged"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>
                
                <!-- 颜色选择器 -->
                <GroupBox Header="自定义颜色" Margin="5">
                    <StackPanel Orientation="Horizontal">
                        <xctk:ColorPicker x:Name="colorPicker" SelectedColorChanged="ColorPicker_SelectedColorChanged" Width="100"/>
                        <Button x:Name="btnSelectBackgroundImage" Content="选择背景图" Click="BtnSelectBackgroundImage_Click" Margin="5" Padding="10,5"/>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </Expander>
        
        <!-- 主显示区域 -->
        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto" x:Name="channelColumn"/>
            </Grid.ColumnDefinitions>
            
            <!-- 主图显示区域 -->
            <Border x:Name="imageContainer" Grid.Column="0" Background="{StaticResource CheckerboardBrush}">
                <ScrollViewer x:Name="imageScrollViewer" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                    <Canvas x:Name="imageCanvas">
                        <Image x:Name="mainImage" 
                               RenderOptions.BitmapScalingMode="HighQuality"
                               Stretch="Uniform"
                               MouseWheel="MainImage_MouseWheel"/>
                    </Canvas>
                </ScrollViewer>
            </Border>
            
            <!-- 通道显示区域 -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Left" VerticalAlignment="Stretch" x:Name="channelSplitter" Visibility="Collapsed"/>
            <Grid x:Name="channelPanel" Grid.Column="1" Width="300" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0" Text="通道预览" FontWeight="Bold" Margin="10,5"/>
                <ScrollViewer Grid.Row="1">
                    <StackPanel x:Name="channelStackPanel"/>
                </ScrollViewer>
            </Grid>
        </Grid>
        
        <!-- 状态栏 -->
        <StatusBar Grid.Row="4">
            <StatusBarItem>
                <TextBlock x:Name="statusText" Text="就绪"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="imageInfoText"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="zoomText" Text="100%"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
